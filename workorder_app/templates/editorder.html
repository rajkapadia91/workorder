<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Extra Work Order Page</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'editorder.css' %}">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/css/select2.min.css" rel="stylesheet" />
    <script defer src="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/js/select2.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/signature_pad@2.3.2/dist/signature_pad.min.js"
        defer></script>
</head>

<body>
    <div id="wrapper">
        <!-- Start This is where the logo and contact info is embedded -->
        <div id="header">
            <div class="head" id="logo_image_div">
                <a href="/"><img id="logo" src="{% static 'logobelcon.png' %}" alt="This is the logo"></a>
            </div>
            <div class="head" id="contact">
                <p class="contact">147 Roseland Ave</p>
                <p class="contact">Caldwell, NJ 07006</p>
                <p class="contact">P (973) 396-1336</p>
            </div>
        </div>
        <!-- End This is where the logo and contact info is embedded -->
        <p>You are about to edit Order #{{edit_this_order.id}} created by {{edit_this_order.user.first_name}}. The only fields that can be edited here are the two signatures along with printing the name</p>
        <div id="links">
            {% if request.session.secret_code == "FGadmin!" %}
            <button><a href="/workorder">Admin View</a></button>
            {% else %}
            <button class="thelinks"><a href="/myworkorders/{{request.session.user_id}}">My Work Orders</a></button>
            {% endif %}
            <button><a href="/">Creating New Extra Work Order</a></button>
            <button><a href="/logout">Logout</a></button>
        </div> <br>
        <div id="actual_order">
            <h3>Extra Work Order No. {{edit_this_order.id}}</h3>
            <p> <span class="titles">General Contractor:</span> {{edit_this_order.jobname.contractor_name}}</p>
            <p> <span class="titles">Name of Job:</span> {{edit_this_order.jobname.name}}</p>
            <p> <span class="titles">Address:</span> {{edit_this_order.jobname.street}}, {{edit_this_order.jobname.city}}, {{edit_this_order.jobname.state}} {{edit_this_order.jobname.zip_code}}</p>
            <p> <span class="titles">Location of Work Performed:</span> {{edit_this_order.location}}</p>
            <p> <span class="titles">Work Performed:</span> {{edit_this_order.work_performed}}</p>
            <hr>
            <h3>Material/s Used:</h3>
            <table>
                <tr>
                    <th>Quantity</th>
                    <th>Product</th>
                </tr>
                {% for material in edit_this_order.materials.all %}
                <tr>
                    <td>{{material.quantity}}</td>
                    <td>{{material.product}}</td>
                </tr>
                {% endfor %}
                <tr>
                    <th>Other: Quantity</th>
                    <th>Other: Product</th>
                </tr>
                <tr>
                    <td>{{edit_this_order.othermaterial.other_quantity}}</td>
                    <td>{{edit_this_order.othermaterial.other_name}}</td>
                </tr>
            </table>
            <h3>Labor Type</h3>
            <table>
                <tr>
                    <th>Labor</th>
                    <th># of Employees</th>
                    <th>Regular Hours</th>
                    <th>Over Hours</th>
                    <th>Doubletime Hours</th>
                </tr>
                <tr>
                    <td>{{edit_this_order.carpenterforeman.labor_type}}</td>
                    <td>{{edit_this_order.carpenterforeman.employee_numbers}}</td>
                    <td>{{edit_this_order.carpenterforeman.regular_hours}}</td>
                    <td>{{edit_this_order.carpenterforeman.over_hours}}</td>
                    <td>{{edit_this_order.carpenterforeman.double_hours}}</td>
                </tr>
                <tr>
                    <td>{{edit_this_order.carpenterjourneyamn.labor_type}}</td>
                    <td>{{edit_this_order.carpenterjourneyamn.employee_numbers}}</td>
                    <td>{{edit_this_order.carpenterjourneyamn.regular_hours}}</td>
                    <td>{{edit_this_order.carpenterjourneyamn.over_hours}}</td>
                    <td>{{edit_this_order.carpenterjourneyamn.double_hours}}</td>
                </tr>
                <tr>
                    <td>{{edit_this_order.taperjourneyman.labor_type}}</td>
                    <td>{{edit_this_order.taperjourneyman.employee_numbers}}</td>
                    <td>{{edit_this_order.taperjourneyman.regular_hours}}</td>
                    <td>{{edit_this_order.taperjourneyman.over_hours}}</td>
                    <td>{{edit_this_order.taperjourneyman.double_hours}}</td>
                </tr>
                <tr>
                    <td>{{edit_this_order.taperforeman.labor_type}}</td>
                    <td>{{edit_this_order.taperforeman.employee_numbers}}</td>
                    <td>{{edit_this_order.taperforeman.regular_hours}}</td>
                    <td>{{edit_this_order.taperforeman.over_hours}}</td>
                    <td>{{edit_this_order.taperforeman.double_hours}}</td>
                </tr>
                <tr>
                    <td>{{edit_this_order.laborer.labor_type}}</td>
                    <td>{{edit_this_order.laborer.employee_numbers}}</td>
                    <td>{{edit_this_order.laborer.regular_hours}}</td>
                    <td>{{edit_this_order.laborer.over_hours}}</td>
                    <td>{{edit_this_order.laborer.double_hours}}</td>
                </tr>
                <tr>
                    <td>{{edit_this_order.supervisor.labor_type}}</td>
                    <td>{{edit_this_order.supervisor.employee_numbers}}</td>
                    <td>{{edit_this_order.supervisor.regular_hours}}</td>
                    <td>{{edit_this_order.supervisor.over_hours}}</td>
                    <td>{{edit_this_order.supervisor.double_hours}}</td>
                </tr>
            </table><br><br><br>
            <hr>
            <div id="contractor_signator">
                <p><span class="titles">Name of General Contractor who Signed the Order:</span> {{edit_this_order.signator_1}} </p>
                <img src="{{edit_this_order.signature_1}}" alt="">
            </div>
            <hr>
            <div id="belcon_signator">
                <p><span class="titles">Name of Belcon Foreman who Signed the Order:</span> {{edit_this_order.signator_2}} </p>
                <img src="{{edit_this_order.signature_2}}" alt="">
            </div>
            <hr>

            <form action="/save_edit/{{edit_this_order.id}}" method="post">
                {% csrf_token %}
            <div id="re-sign">
                <div>
                    <div id="canvas_1">
                        Name of General Contractor Signing: <input type="text" name="signator_1" class="signator_name"
                            id="signator_1" value="{{edit_this_order.signator_1}}"><br><br>
                        <!-- Start This is the canvas functionality -->
                        <img hidden src="{{edit_this_order.signature_1}}" id="imgConverted"
                            style="float: left; background: none; border: 2px solid blue ;" alt="This is the signature">
                        <canvas id="canvas" style="border:black solid 1px;"></canvas>

                        <!-- End This is the canvas functionality -->

                        <!-- Start This is the div for the clear signature and save signature -->

                        <!-- End This is the div for the clear signature and save signature -->
                    </div><br>
                    <p id="TY" hidden>General Contractor has successfully signed!</p>
                    <button type="button" onclick="myFunction()">Clear & Re-Sign</button>
                    <input onclick="saveSignature()" type="button" class="thebutton" id="save1" value="Save Signature">
                    <input type="hidden" name="signature_1" value="{{edit_this_order.signature_1}}" id="sign1"><br>
                </div><br><br>

                <div>
                    <div id="canvas2">
                        Name of Belcon Foreman Signing: <input type="text" name="signator_2" class="signator_name"
                            id="signator_2" value="{{edit_this_order.signator_2}}"><br><br>
                        <!-- Start This is the canvas functionality -->
                        <img hidden src="{{edit_this_order.signature_2}}" id="imgConverted2"
                            style="float: left; background: none; border: 2px solid blue ;" alt="This is the signature">
                        <canvas id="canvas_2" style="border:black solid 1px;"></canvas>
                        <!-- End This is the canvas functionality -->

                        <!-- Start This is the div for the clear signature and save signature -->

                        <!-- End This is the div for the clear signature and save signature -->
                    </div><br>
                    <p id="TY2" hidden>Belcon foreman has successfully signed!</p>
                    <button type="button" onclick="myFunction1()">Clear & Re-Sign</button>
                    <input onclick="saveSignature2()" type="button" class="thebutton" id="save2" value="Save Signature">
                    <input type="hidden" name="signature_2" value="{{edit_this_order.signature_2}}" id="sign2"><br><br>
                </div>
                <input type="submit" value="Sign & Save" class="thebutton" id="sign_save">
            </div>
            </form>
            <div id="empty">

            </div>
        </div>
    </div>
      
        <!-- Start This is the javascript for the signature and other functions -->
        <script>
            var canvas = document.getElementById("canvas"),
                ctx = canvas.getContext("2d"),
                painting = false,
                lastX = 0,
                lastY = 0,
                lineThickness = 1;
    
            canvas.width = 500;
            canvas.height = 150;
            ctx.fillRect(0, 0, 0, 0);
    
            function myFunction() {
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                ctx.beginPath();
    
            }
    
            canvas.onmousedown = function (e) {
                painting = true;
                ctx.fillStyle = "#000000";
                lastX = e.pageX - this.offsetLeft;
                lastY = e.pageY - this.offsetTop;
            };
    
            canvas.onmouseup = function (e) {
                painting = false;
            }
    
            canvas.onmousemove = function (e) {
                if (painting) {
                    mouseX = e.pageX - this.offsetLeft;
                    mouseY = e.pageY - this.offsetTop;
    
                    // find all points between        
                    var x1 = mouseX,
                        x2 = lastX,
                        y1 = mouseY,
                        y2 = lastY;
    
    
                    var steep = (Math.abs(y2 - y1) > Math.abs(x2 - x1));
                    if (steep) {
                        var x = x1;
                        x1 = y1;
                        y1 = x;
    
                        var y = y2;
                        y2 = x2;
                        x2 = y;
                    }
                    if (x1 > x2) {
                        var x = x1;
                        x1 = x2;
                        x2 = x;
    
                        var y = y1;
                        y1 = y2;
                        y2 = y;
                    }
    
                    var dx = x2 - x1,
                        dy = Math.abs(y2 - y1),
                        error = 0,
                        de = dy / dx,
                        yStep = -1,
                        y = y1;
    
                    if (y1 < y2) {
                        yStep = 1;
                    }
    
                    lineThickness = 5 - Math.sqrt((x2 - x1) * (x2 - x1) + (y2 - y1) * (y2 - y1)) / 10;
                    if (lineThickness < 1) {
                        lineThickness = 1;
                    }
    
                    for (var x = x1; x < x2; x++) {
                        if (steep) {
                            ctx.fillRect(y, x, lineThickness, lineThickness);
                        } else {
                            ctx.fillRect(x, y, lineThickness, lineThickness);
                        }
    
                        error += de;
                        if (error >= 0.5) {
                            y += yStep;
                            error -= 1.0;
                        }
                    }
    
    
    
                    lastX = mouseX;
                    lastY = mouseY;
    
                }
    
            }
            function saveSignature() {
                var dataURI = canvas.toDataURL("image/png");
                sign1.value = dataURI;
                imgConverted.src = dataURI;
            }
    
            $('#save1').click(function () {
                $('#canvas_1').toggle();
                document.getElementById("TY").hidden = false;
            });
    
            // Javascript for the second canvas
            var canvas_2 = document.getElementById("canvas_2"),
                context = canvas_2.getContext("2d"),
                painting = false,
                lastX = 0,
                lastY = 0,
                lineThickness = 1;
    
            canvas_2.width = 500;
            canvas_2.height = 150;
            context.fillRect(0, 0, 0, 0);
    
            function myFunction1() {
                context.clearRect(0, 0, context.canvas.width, context.canvas.height);
                context.beginPath();
    
    
            }
    
            canvas_2.onmousedown = function (e) {
                painting = true;
                context.fillStyle = "#000000";
                lastX = e.pageX - this.offsetLeft;
                lastY = e.pageY - this.offsetTop;
            };
    
            canvas_2.onmouseup = function (e) {
                painting = false;
            }
    
            canvas_2.onmousemove = function (e) {
                if (painting) {
                    mouseX = e.pageX - this.offsetLeft;
                    mouseY = e.pageY - this.offsetTop;
    
                    // find all points between        
                    var x1 = mouseX,
                        x2 = lastX,
                        y1 = mouseY,
                        y2 = lastY;
    
    
                    var steep = (Math.abs(y2 - y1) > Math.abs(x2 - x1));
                    if (steep) {
                        var x = x1;
                        x1 = y1;
                        y1 = x;
    
                        var y = y2;
                        y2 = x2;
                        x2 = y;
                    }
                    if (x1 > x2) {
                        var x = x1;
                        x1 = x2;
                        x2 = x;
    
                        var y = y1;
                        y1 = y2;
                        y2 = y;
                    }
    
                    var dx = x2 - x1,
                        dy = Math.abs(y2 - y1),
                        error = 0,
                        de = dy / dx,
                        yStep = -1,
                        y = y1;
    
                    if (y1 < y2) {
                        yStep = 1;
                    }
    
                    lineThickness = 5 - Math.sqrt((x2 - x1) * (x2 - x1) + (y2 - y1) * (y2 - y1)) / 10;
                    if (lineThickness < 1) {
                        lineThickness = 1;
                    }
    
                    for (var x = x1; x < x2; x++) {
                        if (steep) {
                            context.fillRect(y, x, lineThickness, lineThickness);
                        } else {
                            context.fillRect(x, y, lineThickness, lineThickness);
                        }
    
                        error += de;
                        if (error >= 0.5) {
                            y += yStep;
                            error -= 1.0;
                        }
                    }
    
    
    
                    lastX = mouseX;
                    lastY = mouseY;
    
                }
    
            }
            function saveSignature2() {
                var dataURI2 = canvas_2.toDataURL("image/png");
                sign2.value = dataURI2;
                imgConverted2.src = dataURI2;
            }
    
            $('#save2').click(function () {
                $('#canvas2').toggle();
                document.getElementById("TY2").hidden = false;
            });
        
        </script>
</body>

</html>